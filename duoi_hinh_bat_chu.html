<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Đuổi Hình Bắt Chữ — HTML</title>
  <style>
    .watermark {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 18px;
    font-weight: bold;
    color: #ffffffcc;
    background: rgba(0,0,0,0.4);
    padding: 6px 12px;
    border-radius: 8px;
    font-family: Arial, sans-serif;
}
    :root{--bg:#f6f9ff;--card:#ffffff;--muted:#6b7280;--accent:#0ea5e9}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; background:linear-gradient(180deg,var(--bg),#eef2ff);color:#0f172a}
    .container{max-width:1100px;margin:28px auto;padding:18px}
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(15,23,42,0.06)}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
    h1{margin:0;font-size:20px}
    .meta{color:var(--muted);font-size:13px}
    .layout{display:grid;gap:16px;grid-template-columns:2fr 1fr}
    .image-wrap{position:relative;border-radius:10px;overflow:hidden}
    .puzzle-img{width:100%;height:320px;object-fit:cover;transition:filter .35s,transform .35s}
    .blur{filter:blur(6px) brightness(.9) saturate(.9);transform:scale(1.03)}
    .controls{position:absolute;right:12px;top:12px;display:flex;gap:8px}
    button{cursor:pointer}
    .btn{border:0;padding:8px 10px;border-radius:8px;background:#eef2ff;color:var(--accent);font-weight:600}
    .btn.danger{background:#fecaca;color:#7f1d1d}
    .btn.gray{background:#f3f4f6;color:#374151}
    .bank{display:grid;grid-template-columns:repeat(auto-fit,minmax(40px,1fr));gap:8px}
    .letter{background:#fff;border-radius:8px;padding:10px;text-align:center;font-weight:700;box-shadow:0 4px 10px rgba(2,6,23,.06);user-select:none}
    .letter.disabled{opacity:.35}
    .answer-area{display:flex;flex-wrap:wrap;gap:8px;padding:10px;border-radius:8px;background:#f8fafc;margin-top:12px}
    .answer-letter{padding:8px 12px;border-radius:8px;background:#fff;border:1px dashed #e6edf3;min-width:36px;text-align:center;font-weight:700}
    .sidebar .card{padding:12px}
    .small{font-size:13px;color:var(--muted)}
    .message{margin-top:12px;font-weight:700;color:#dc2626}
    .topbar{display:flex;gap:12px;align-items:center}
    .score{font-weight:800}
    .timer{background:#0ea5e9;color:#fff;padding:6px 10px;border-radius:8px}
    @media(max-width:880px){.layout{grid-template-columns:1fr}.puzzle-img{height:220px}}
  </style>
</head>
<body>
  <div class="watermark">Nguyễn Quang Minh 12A2</div>
  <div class="container">
    <div class="card">
      <header>
        <div>
          <h1>Đuổi hình bắt chữ</h1>
          <div class="meta">Bấm chữ để chọn, Enter kiểm tra, Backspace xóa chữ cuối.</div>
        </div>
        <div class="topbar">
          <div class="small">Vòng <span id="roundNum">1</span>/<span id="totalRounds">3</span></div>
          <div class="score">Điểm: <span id="score">0</span></div>
          <div class="timer" id="timer">60s</div>
        </div>
      </header>

      <div class="layout">
        <main>
          <div class="image-wrap card">
            <img id="puzzleImage" class="puzzle-img blur" alt="puzzle">
            <div style="position:absolute;left:12px;top:12px;background:rgba(255,255,255,.8);padding:6px 8px;border-radius:8px;font-weight:600">Thời gian: <span id="timeLeft">60</span>s</div>
            <div class="controls">
              <button class="btn" id="revealBtn">Mở rõ (-3)</button>
              <button class="btn" id="hintBtn">Gợi ý (-5)</button>
              <button class="btn danger" id="skipBtn">Bỏ qua</button>
            </div>
          </div>

          <div style="margin-top:14px" class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
              <div class="small">Bộ chữ (chạm/nhấn để chọn)</div>
              <div style="display:flex;gap:8px">
                <button class="btn gray" id="clearBtn">Xóa chọn</button>
                <button class="btn" id="checkBtn">Kiểm tra</button>
              </div>
            </div>

            <div id="letterBank" class="bank"></div>

            <div class="small" style="margin-top:10px">Câu trả lời của bạn:</div>
            <div id="answerArea" class="answer-area"></div>
            <div class="message" id="message"></div>
          </div>
        </main>

        <aside class="sidebar">
          <div class="card">
            <h3 style="margin:0 0 8px 0">Gợi ý</h3>
            <div class="small" id="hintText">Nhấn "Gợi ý" để hiện gợi ý (trừ điểm).</div>
          </div>

          <div class="card">
            <h3 style="margin:0 0 8px 0">Thống kê</h3>
            <div class="small">Đã làm: <span id="doneCount">0</span></div>
            <div class="small">Đang chạy: <span id="runningState">Có</span></div>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button class="btn gray" id="prevBtn">Vòng trước</button>
              <button class="btn gray" id="nextBtn">Vòng sau</button>
            </div>
          </div>

          <div class="card">
            <h3 style="margin:0 0 8px 0">Lưu ý</h3>
            <ul class="small" style="margin:0;padding-left:18px">
              <li>Gợi ý và mở rõ ảnh sẽ trừ điểm.</li>
              <li>Muốn bộ câu hỏi khác? Mở mã và chỉnh mảng <code>puzzles</code>.</li>
            </ul>
          </div>
        </aside>
      </div>

      <footer style="margin-top:14px;text-align:center" class="small">Muốn xuất thành file hoặc thêm tính năng? Cho mình biết.</footer>
    </div>
  </div>

  <script>
    // Standalone Đuổi Hình Bắt Chữ — minimal but functional
    const puzzles = [
      { id:1, image: 'https://hoanghamobile.com/tin-tuc/wp-content/uploads/2024/05/hinh-anh-mat-troi-61.jpg', answer: 'MẶT TRỜI', hint: 'Thiên thể tỏa sáng ban ngày' },
      { id:2, image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR8vjUY8Ld6cuKFycFECbRPBQr6HLX9UHR3HQ&s', answer: 'CÂY DỪA', hint: 'Loài cây gắn liền bờ biển và dừa' },
      { id:3, image: 'https://hoanghamobile.com/tin-tuc/wp-content/uploads/2024/06/hinh-anh-may-bay.jpg', answer: 'MÁY BAY', hint: 'Phương tiện bay chở hành khách' }
    ];

    // DOM refs
    const puzzleImage = document.getElementById('puzzleImage');
    const letterBankEl = document.getElementById('letterBank');
    const answerArea = document.getElementById('answerArea');
    const messageEl = document.getElementById('message');
    const hintText = document.getElementById('hintText');
    const timeLeftEl = document.getElementById('timeLeft');
    const timerEl = document.getElementById('timer');
    const scoreEl = document.getElementById('score');
    const roundNum = document.getElementById('roundNum');
    const totalRounds = document.getElementById('totalRounds');
    const doneCount = document.getElementById('doneCount');
    const runningState = document.getElementById('runningState');

    const revealBtn = document.getElementById('revealBtn');
    const hintBtn = document.getElementById('hintBtn');
    const skipBtn = document.getElementById('skipBtn');
    const checkBtn = document.getElementById('checkBtn');
    const clearBtn = document.getElementById('clearBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    // Game state
    let index = Number(localStorage.getItem('dhbc_index') || 0);
    let score = Number(localStorage.getItem('dhbc_score') || 0);
    let timeLeft = 60;
    let timer = null;
    let running = true;
    let selected = []; // {letter, fromIndex}
    let usedIndexes = new Set();
    let bank = [];
    let done = Number(localStorage.getItem('dhbc_done') || 0);

    totalRounds.textContent = puzzles.length;

    function normalize(s){ return s.replace(/\s+/g,'').toUpperCase(); }

    function buildBank(answer){
      const letters = normalize(answer).split('');
      const extras = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
      while(letters.length < Math.max(12, normalize(answer).length*2)){
        letters.push(extras[Math.floor(Math.random()*extras.length)]);
      }
      // shuffle
      for(let i=letters.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [letters[i],letters[j]]=[letters[j],letters[i]] }
      return letters;
    }

    function saveState(){ localStorage.setItem('dhbc_index', String(index)); localStorage.setItem('dhbc_score', String(score)); localStorage.setItem('dhbc_done', String(done)); }

    function render(){
      const p = puzzles[index];
      puzzleImage.src = p.image;
      puzzleImage.alt = p.answer;
      roundNum.textContent = index+1;
      scoreEl.textContent = score;
      timeLeftEl.textContent = timeLeft;
      timerEl.textContent = timeLeft+'s';
      doneCount.textContent = done;
      runningState.textContent = running ? 'Có' : 'Không';
      hintText.textContent = 'Nhấn "Gợi ý" để hiện gợi ý (trừ điểm).';
      messageEl.textContent = '';

      bank = buildBank(p.answer);
      usedIndexes = new Set(); selected = [];
      renderBank(); renderAnswer();
    }

    function renderBank(){
      letterBankEl.innerHTML = '';
      bank.forEach((l,i)=>{
        const b = document.createElement('div');
        b.className = 'letter';
        b.textContent = l;
        b.dataset.idx = i;
        if(usedIndexes.has(i)) b.classList.add('disabled');
        b.addEventListener('click', ()=>{ if(usedIndexes.has(i)) return; pickLetter(i); });
        letterBankEl.appendChild(b);
      })
    }

    function renderAnswer(){
      answerArea.innerHTML = '';
      selected.forEach((s, idx)=>{
        const d = document.createElement('div'); d.className='answer-letter'; d.textContent = s.letter; d.title='Nhấn để xoá';
        d.addEventListener('click', ()=> removeSelected(idx));
        answerArea.appendChild(d);
      });
    }

    function pickLetter(i){
      if(usedIndexes.has(i)) return; usedIndexes.add(i); selected.push({letter:bank[i],from:i}); renderBank(); renderAnswer(); }
    function removeSelected(pos){ const it = selected[pos]; if(!it) return; selected = selected.filter((_,i)=>i!==pos); usedIndexes.delete(it.from); renderBank(); renderAnswer(); }

    function currentAttempt(){ return selected.map(s=>s.letter).join(''); }

    function checkAnswer(){
      const attempt = normalize(currentAttempt());
      const expected = normalize(puzzles[index].answer);
      if(!attempt) return;
      if(attempt === expected){ messageEl.style.color = 'green'; messageEl.textContent = 'Chính xác!'; score += 10 + Math.max(0, timeLeft); done += 1; running = false; saveState(); render(); setTimeout(()=>{ nextRound(); }, 800); }
      else{ messageEl.style.color = '#b91c1c'; messageEl.textContent = 'Sai rồi — thử lại hoặc dùng gợi ý'; score = Math.max(0, score-2); saveState(); render(); }
    }

    function useHint(){ hintText.textContent = puzzles[index].hint; score = Math.max(0, score-5); saveState(); render(); }
    function revealImage(){ puzzleImage.classList.remove('blur'); score = Math.max(0, score-3); saveState(); render(); }
    function skipRound(){ messageEl.style.color = '#b91c1c'; messageEl.textContent = 'Bỏ qua — đáp án: ' + puzzles[index].answer; running = false; saveState(); setTimeout(()=> nextRound(), 800); }

    function nextRound(){ index = (index+1) % puzzles.length; timeLeft = 60; running = true; puzzleImage.classList.add('blur'); render(); startTimer(); }
    function prevRound(){ index = Math.max(0, index-1); timeLeft = 60; running = true; puzzleImage.classList.add('blur'); render(); startTimer(); }

    function clearSelection(){ selected = []; usedIndexes = new Set(); renderBank(); renderAnswer(); messageEl.textContent=''; }

    function startTimer(){ if(timer) clearInterval(timer); timer = setInterval(()=>{ if(!running) return; timeLeft--; if(timeLeft<=0){ clearInterval(timer); running=false; messageEl.style.color='#b91c1c'; messageEl.textContent='Hết giờ! Đáp án: ' + puzzles[index].answer; saveState(); } render(); }, 1000); }

    // Buttons
    revealBtn.addEventListener('click', ()=>{ revealImage(); });
    hintBtn.addEventListener('click', ()=>{ useHint(); });
    skipBtn.addEventListener('click', ()=>{ skipRound(); });
    checkBtn.addEventListener('click', ()=>{ checkAnswer(); });
    clearBtn.addEventListener('click', ()=>{ clearSelection(); });
    prevBtn.addEventListener('click', ()=>{ prevRound(); });
    nextBtn.addEventListener('click', ()=>{ nextRound(); });

    // Keyboard support
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'Backspace'){ removeSelected(selected.length-1); }
      else if(e.key === 'Enter'){ checkAnswer(); }
      else {
        const key = e.key.toUpperCase();
        if(/^[A-ZÀ-Ỹ]$/.test(key)){
          const idx = bank.findIndex((l,i)=> l === key && !usedIndexes.has(i));
          if(idx !== -1) pickLetter(idx);
        }
      }
    });

    // init
    function init(){ render(); startTimer(); }
    init();
  </script>
</body>
</html>
